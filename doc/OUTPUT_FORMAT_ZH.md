# 输出格式说明

本文档描述了在使用本项目后，您可以预期的各种输出文件的格式和位置。

---

## 1. 检测结果

当通过 `run.sh` 或直接运行 `src/run_cli.py` 并启用保存选项时，脚本会将检测结果（带标注的图片/视频、JSON数据）保存到磁盘。

### 1.1 输出目录结构

所有检测结果都保存在由 `--output_dir` 参数指定的目录中（`run.sh` 默认为 `results/detection_output_[model_name]`）。

*   **如果输入源是一个目录 (例如 `imgs/`)**:
    该目录下的所有结果文件会**直接**存放在输出目录中。
    ```
    results/detection_output_best/
    ├── processed_1.jpg         # 带标注的图片
    ├── 1.txt                   # 图片1的JSON数据
    ├── processed_2.jpg         # 带标注的图片
    ├── 2.txt                   # 图片2的JSON数据
    └── ...
    ```

*   **如果输入源是单个视频文件 (例如 `my_video.mp4`)**:
    处理后的视频文件会**直接**存放在输出目录中。
    ```
    results/detection_output_best/
    └── processed_my_video.mp4  # 带标注的视频
    ```
    *注意：当前版本的 `run_cli.py` 在处理视频时，为了性能，会将每一帧临时存为图片再检测，但**不会**为视频的每一帧都保存单独的JSON数据文件。*

### 1.2 可视化输出 (图片/视频)

*   **内容**: 输出的图片或视频帧上会清晰地绘制检测到的目标边界框，并附有类别名称和置信度分数。
*   **命名**:
    *   对于图片，输出文件名通常是在原文件名前加上 `processed_` 前缀。
    *   对于视频，输出文件名通常也是在原文件名前加上 `processed_` 前缀。

### 1.3 JSON 数据文件

*   **机制**: 当处理图片时，脚本会为每个输入图片生成一个对应的 `.txt` 文件，其内容为JSON格式。
*   **命名**: `.txt` 文件的名称与原始图片的文件名（不含扩展名）相同。

*   **JSON 文件内容结构**:
    每个 `.txt` 文件包含一个JSON数组。数组中的每个元素是一个JSON对象，代表在该图片中检测到的一个目标。

    ```json
    [
      {
        "label": "tennis_ball",
        "confidence": 0.9234,
        "bbox": [120, 235, 55, 60]
      }
    ]
    ```
    如果某张图片未检测到目标，则对应的 `.txt` 文件内容为一个空数组 `[]`。

*   **字段说明**: 
    *   `label` (string): 目标类别名称。
    *   `confidence` (float): 检测的置信度分数 (0.0 到 1.0)。
    *   `bbox` (array of int): 边界框位置，格式为 `[x_min, y_min, width, height]`。
        *   `x_min`, `y_min`: 边界框左上角顶点的坐标。
        *   `width`, `height`: 边界框的宽度和高度。

---

## 2. 训练输出

当您运行模型训练时，所有训练产物会保存在 `tennis_ball_runs/[your_run_name]/` 目录下。

*   **关键文件**:
    *   `weights/best.pt`: **最佳模型**，在验证集上表现最好，通常是您应该使用的模型。
    *   `weights/last.pt`: 最后一次训练迭代保存的模型。
    *   `results.csv`: 记录每个训练周期的详细指标（损失、mAP等）的表格。
    *   各种图表文件 (`.png`): 如损失曲线、mAP曲线、混淆矩阵等，用于可视化评估。
    *   `args.yaml`: 本次训练所使用的所有超参数配置。

这些输出对于监控和评估模型性能至关重要。 